<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Partager ma position</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
  label, input, button { display: block; margin: 10px 0; font-size: 16px; }
  input { padding: 8px; width: 200px; }
  button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
  #status { margin-top: 20px; font-weight: bold; }
</style>
</head>
<body>

<h1>Partager ma position</h1>
<label for="callsign">Ton callsign :</label>
<input type="text" id="callsign" placeholder="Ex: KENZO" />

<button id="toggleTracking">Activer partage position</button>

<div id="status"></div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
// TODO: Remplace cette config par ta config Firebase !
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyABEP_KAW9R4dYpnDS9BANn6vcQCICxzrU",
  authDomain: "kenzomc-ad1c2.firebaseapp.com",
  databaseURL: "https://kenzomc-ad1c2-default-rtdb.firebaseio.com",
  projectId: "kenzomc-ad1c2",
  storageBucket: "kenzomc-ad1c2.firebasestorage.app",
  messagingSenderId: "459457032331",
  appId: "1:459457032331:web:af7e0d8c958a807ce2648e",
  measurementId: "G-341YD1GPC5"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let watchId = null;
let isSharing = false;

const btn = document.getElementById('toggleTracking');
const callsignInput = document.getElementById('callsign');
const statusDiv = document.getElementById('status');

function sendPosition(position) {
  const callsign = callsignInput.value.trim();
  if (!callsign) {
    statusDiv.textContent = 'Merci d\'entrer un callsign avant de partager.';
    stopSharing();
    return;
  }

  const lat = position.coords.latitude;
  const lon = position.coords.longitude;

  // Tu peux ajouter ici une fonction pour filtrer la zone géographique

  db.ref('positions/' + callsign).set({
    lat: lat,
    lon: lon,
    timestamp: Date.now()
  }).catch(err => {
    statusDiv.textContent = 'Erreur en envoyant la position : ' + err;
  });
  statusDiv.textContent = `Position envoyée : ${lat.toFixed(5)}, ${lon.toFixed(5)}`;
}

function startSharing() {
  if (!navigator.geolocation) {
    statusDiv.textContent = 'Géolocalisation non supportée par ton navigateur.';
    return;
  }

  watchId = navigator.geolocation.watchPosition(sendPosition, (err) => {
    statusDiv.textContent = 'Erreur géolocalisation : ' + err.message;
  }, {
    enableHighAccuracy: true,
    maximumAge: 10000,
    timeout: 10000
  });

  btn.textContent = 'Désactiver partage position';
  isSharing = true;
}

function stopSharing() {
  if (watchId !== null) {
    navigator.geolocation.clearWatch(watchId);
    watchId = null;
  }
  if (callsignInput.value.trim()) {
    db.ref('positions/' + callsignInput.value.trim()).remove();
  }
  btn.textContent = 'Activer partage position';
  statusDiv.textContent = 'Partage désactivé.';
  isSharing = false;
}

btn.addEventListener('click', () => {
  if (isSharing) {
    stopSharing();
  } else {
    startSharing();
  }
});
</script>

</body>
</html>
